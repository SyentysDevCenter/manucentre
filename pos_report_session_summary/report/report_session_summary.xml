<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    <template id="report_sessionsummary">
    <t t-call="web.html_container">
    <t t-call="web.basic_layout">
        <div class="page">
            <h2>Résumé de la session :<span t-esc="session_name"/></h2>

            <div class="row mt32 mb32">
                <div class="col-auto mw-100 mb-3">
                    <strong>Responsable</strong>:<br/>
                    <span t-esc="session_user"/>
                </div>
                <div class="col-auto mw-100 mb-3">
                    <strong>Point de vente</strong>:<br/>
                    <span t-esc="session_name"/>
                </div>
                <div class="col-auto mw-100 mb-3">
                    <strong>Date d'ouverture</strong>:<br/>
                    <span t-esc="session_start"/>
                </div>
                <div class="col-auto mw-100 mb-3">
                    <strong>Date de clôture</strong>:<br/>
                    <span t-esc="session_stop"/>
                </div>
            </div>

            <h4>Résumé du relevé</h4>

            <table class="table table-sm o_main_table">
                <thead>
                    <tr>
                        <th>
                            <strong>Pos Pyament</strong>
                        </th>
                        <th>
                            <strong>Montant</strong>
                        </th>
                        <th class="text-right">
                            <strong>Type</strong>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr t-foreach='pos_payments_by_method' t-as='method'>
                        <td><t t-esc="method['name']" /></td>
                        <td><t t-esc="method['amount']" t-options="{'widget': 'float', 'precision': currency_precision}"/></td>
                        <td class="text-right"><t t-esc="method['type']" /></td>
                    </tr>
                </tbody>
            </table>

            <br/>

            <div>
                <strong>Chiffre d'affaire TTC</strong>: <t t-esc="total_all"/><br/>
                <strong>Chiffre d'affaire HT</strong>: <t t-esc="total_untaxed"/><br/>
                <strong>TVA</strong>: <t t-esc="'%.2f'%(taxes_total)"/><br/>
                <t t-foreach='taxes' t-as='tax'>
                    <strong><t t-esc="tax['name']" />: </strong>
                    <t t-esc="tax['tax_amount']" t-options="{'widget': 'float', 'precision': currency_precision}"/><br/>
                </t>
            </div>


            <!-- pos orders group by payment method -->
            <t t-set="payment_method" t-value="[]"/>
            <t t-foreach="pos_payments" t-as="p">
                <t t-set="payment_method" t-value="payment_method+[p['payment_method']]"/>
            </t>

            <t t-foreach="set(payment_method)" t-as="payment_method_group">
                <p style="page-break-after:always;"/>
                <h4>Détails du Relevé : <span t-esc="payment_method_group"/></h4>

                <table class="table table-sm o_main_table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Transaction</th>
                            <th>Session</th>
                            <th>Client</th>
                            <th>Vendeur</th>
                            <th class="text-right">Montant</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="pos_payments" t-as="p">
                            <tr t-if="payment_method_group == p['payment_method']">
                                <td><span t-esc="p['payment_date']"/></td>
                                <td><span t-esc="p['pos_reference']"/></td>
                                <td><span t-esc="p['pos_session']"/></td>
                                <td><span t-esc="p['name']"/></td>
                                <td><span t-esc="p['user_id']"/></td>
                                <td class="text-right"><span t-esc="p['amount']" t-options="{'widget': 'float', 'precision': currency_precision}"/></td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </t>

            <br/>

            <!-- bo -->
            <p style="page-break-after:always;"/>
            <h4 t-if="payments_bo">Détails du Relevé : Paiment BO</h4>

                <table class="table table-sm o_main_table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Transaction</th>
                            <th>Session</th>
                            <th>Client</th>
                            <th>Vendeur</th>
                            <th class="text-right">Montant</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr  t-foreach="payments_bo" t-as="bo">
                            <td><span t-esc="bo['payment_date']"/></td>
                            <td><span t-esc="bo['name']"/></td>
                            <td><span t-esc="bo['pos_session_id']"/></td>
                            <td><span t-esc="bo['partner_id']"/></td>
                            <td><span t-esc="bo['create_uid']"/></td>
                            <td class="text-right"><span t-esc="bo['amount']"/></td>
                        </tr>
                    </tbody>
                </table>

        </div>
    </t>
    </t>
    </template>

    <template id="pos_report_sessionsummary">
        <t t-call="web.html_container">
            <t t-call="pos_report_session_summary.report_sessionsummary"/>
        </t>
    </template>
    </data>
</odoo>